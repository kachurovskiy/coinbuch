<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>coinbuch</title>
  <link rel="icon" href="data:,">
  <script type="module" crossorigin>
var Y=Object.defineProperty;var A=(r,e,t)=>e in r?Y(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var v=(r,e,t)=>(A(r,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerPolicy&&(i.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?i.credentials="include":s.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}})();const I=["Advanced Trade Buy","Receive"],b=["Advanced Trade Sell","Send"],$=b.concat(["Withdrawal"]),W=I.concat(["Deposit","Reward Income","Subscription Rebate","Subscription Rebates (24 Hours)"]),B=["Advanced Trade Buy","Advanced Trade Sell","Deposit","Receive","Reward Income","Send","Subscription Rebate","Subscription Rebates (24 Hours)","Withdrawal"],E=["AUD","CAD","CHF","CNY","EUR","GBP","HKD","JPY","KRW","NZD","SGD","USD"],H=new Map([["AUD","A$"],["CAD","C$"],["CHF","CHF"],["CNY","¥"],["EUR","€"],["GBP","£"],["HKD","$"],["JPY","¥"],["KRW","₩"],["NZD","NZ$"],["SGD","SGD"],["USD","$"]]),L=["USDC","USDT"],J=1e-7;class l{constructor(e,t){v(this,"amount");v(this,"currency");this.amount=e,this.currency=t}toString(){return this.toFixed(2)}plus(e){if(this.currency!==e.currency)throw new Error(`Cannot add ${this.currency} and ${e.currency}`);return new l(this.amount+e.amount,this.currency)}minus(e){if(this.currency!==e.currency)throw new Error(`Cannot subtract ${this.currency} and ${e.currency}`);return new l(this.amount-e.amount,this.currency)}multiply(e){return new l(this.amount*e,this.currency)}convert(e,t,n){const s=n||t.targetCurrency;if(this.currency===s)return this;const i=e.toISOString().split("T")[0],u=t.getExchangeRateFromUSD(i);if(u===void 0)throw new Error(`Exchange rate for ${s} at ${i} not found`);if(this.currency==="USD")return new l(this.amount*u,s);if(s==="USD"&&this.currency===t.targetCurrency)return new l(this.amount/u,s);throw new Error(`Cannot convert ${this.currency} to ${s}`)}toFixed(e){return this.amount?this.amount.toFixed(e)+f(this.currency):""}}async function K(r,e,t){if(r==="USD")return{targetCurrency:"USD",convertFromUSD:o=>o,getExchangeRateFromUSD:()=>1};const n=`exchangeRates-${r}`,s=JSON.parse(localStorage.getItem(n)||"{}"),u=Array.from(new Set(e.map(o=>o.time.toISOString().split("T")[0]))).filter(o=>!(o in s));try{for(const o of u){const a=`https://api.coinbase.com/v2/prices/${r}-USD/spot?date=${o}`,d=await fetch(a);if(!d.ok)throw new Error(`HTTP error! status: ${d.status}`);const c=await d.json(),y=parseFloat(c.data.amount);s[o]=y,t(`Fetched exchange rate for ${o}: ${y}`),localStorage.setItem(n,JSON.stringify(s))}}catch(o){throw console.error("Error fetching exchange rates:",o),new Error("Failed to fetch exchange rates")}return{targetCurrency:r,convertFromUSD:(o,a)=>{const d=a.toISOString().split("T")[0],c=s[d];if(c===void 0)throw new Error(`Exchange rate for ${d} not found`);return parseFloat((o/c).toFixed(2))},getExchangeRateFromUSD:o=>1/s[o]}}function f(r){return H.get(r)||r}function Z(r,e){for(const t of r)if(t.priceCurrency!==e&&t.asset!==e)return!0;return!1}function k(r,e){return r.time.getFullYear()<2e3||r.time.getFullYear()>2100?`Invalid year ${r.time.getFullYear()} in row ${JSON.stringify(e)}`:B.includes(r.type)?isNaN(r.quantity)?`Invalid quantity ${r.quantity} in row ${JSON.stringify(e)}`:isNaN(r.price.amount)||r.price.amount<0?`Invalid price ${r.price} in row ${JSON.stringify(e)}`:isNaN(r.fee.amount)||r.fee.amount<0?`Invalid fee ${r.fee} in row ${JSON.stringify(e)}`:isNaN(r.subtotal.amount)?`Invalid subtotal ${r.subtotal} in row ${JSON.stringify(e)}`:isNaN(r.total.amount)?`Invalid total ${r.total} in row ${JSON.stringify(e)}`:"":`Invalid transaction type ${r.type} in row ${JSON.stringify(e)}`}function Q(r,e){const t=r.subtotal.plus(r.fee.multiply(b.includes(r.type)?-1:1));if(t.amount>0&&Math.abs(1-r.total.amount/t.amount)>.001&&Math.abs(r.total.amount-t.amount)>1)return`Invalid total ${r.total} - expected ${t} in row ${JSON.stringify(e)}`;const n=Math.abs(r.price.amount*r.quantity);return r.quantity!==0&&Math.abs(1-n/r.subtotal.amount)>.002&&Math.abs(n-r.subtotal.amount)>1?`Invalid subtotal ${n} - expected ${r.subtotal} in row ${JSON.stringify(e)}`:""}function j(r){const e=r.split(`
`);for(;!e[0].startsWith("ID");)e.shift();const t=e[0].split(",");e.shift();const n=[];for(let s of e){if(s=s.trim(),!s)continue;const i=s.split(",");if(i.length!==t.length)throw new Error(`Invalid row: ${s}`);const u=new Map;u.set("raw",s);for(let o=0;o<t.length;o++){let a=i[o];a.startsWith('"')&&a.endsWith('"')&&(a=a.slice(1,-1)),u.set(t[o],a)}n.push(Object.fromEntries(u))}return n}function z(r){const e=j(r),t=[],n=[],s=[];for(const i of e){const u=i["Price Currency"];let o={raw:i.raw,id:i.ID,time:X(i.Timestamp),type:i["Transaction Type"],asset:i.Asset,quantity:S(i["Quantity Transacted"]),price:new l(S(i["Price at Transaction"]),u),priceCurrency:u,subtotal:new l(S(i.Subtotal),u),total:new l(S(i["Total (inclusive of fees and/or spread)"]),u),fee:new l(S(i["Fees and/or Spread"]),u),notes:i.Notes,quantitySold:0,gainOrLoss:new l(0,u)};o.asset==="USDC"&&u==="USD"&&(o=V(o));const a=k(o,i);if(a){n.push(a);continue}const d=Q(o,i);d&&s.push(d),t.push(o)}return t.sort((i,u)=>i.time.getTime()-u.time.getTime()),{transactions:t,errors:n,warnings:s}}function V(r){const e=r.notes.match(/(Bought|Sold) ([0-9.]+) USDC for ([0-9.]+) ([A-Z]+) on ([A-Z]+-[A-Z]+) at ([0-9.]+) ([A-Z]+\/USDC)/);if(!e)return r;const t=S(e[2]),n=e[4],s=S(e[6]),i=new l(S(e[3]),n),u=new l(r.fee.amount*s,n);return{...r,quantity:t,price:new l(s,n),priceCurrency:n,fee:u,subtotal:i.minus(u),total:i,gainOrLoss:new l(0,n)}}function F(r){return["Quantity Transacted","Price at Transaction","Subtotal","Total (inclusive of fees and/or spread)","Fees and/or Spread"].includes(r)}function S(r){return r?Math.abs(parseFloat(r.replace(/\$/,""))):0}function X(r){if(!r)throw new Error("Invalid timestamp: "+r);const e=r.split(" ");if(e.length!==3)throw new Error(`Invalid timestamp: ${r}`);if(e[2]!=="UTC")throw new Error(`Invalid timezone: ${e[2]}`);const t=e[0].split("-"),n=e[1].split(":");return new Date(Date.UTC(parseInt(t[0]),parseInt(t[1])-1,parseInt(t[2]),parseInt(n[0]),parseInt(n[1]),parseInt(n[2])))}class _{render(e){const t=document.createElement("div");if(t.classList.add("sectionErrors"),e.file.errors.length){const n=document.createElement("h2");n.innerText="Errors",t.appendChild(n)}for(const n of e.file.errors){const s=document.createElement("div");s.innerText=n,s.classList.add("error"),t.appendChild(s)}if(e.file.warnings.length){const n=document.createElement("h2");n.innerText="Warnings",t.appendChild(n)}for(const n of e.file.warnings){const s=document.createElement("div");s.innerText=n,s.classList.add("warning"),t.appendChild(s)}return t}}class ee{constructor(e,t,n){this.model=e,this.year=t,this.transactions=n}render(){const e=document.createElement("div"),t=document.createElement("h3");t.innerText="Calendar year "+this.year,e.appendChild(t);const n=document.createElement("table");n.classList.add("yearSecurityTable"),e.appendChild(n);const s=document.createElement("thead");n.appendChild(s);const i=document.createElement("tr");s.appendChild(i);const u=["Security","First buy","Last sell","Gain "+f(this.model.exchange.targetCurrency)];for(const h of u){const m=document.createElement("th");m.innerText=h,F(h)&&m.classList.add("numeric"),i.appendChild(m)}const o=new Map;for(const h of this.transactions){const m=h.asset,C=o.get(m)||new l(0,this.model.exchange.targetCurrency),w=h.gainOrLoss.convert(h.time,this.model.exchange);o.set(m,C.plus(w))}const a=new Map,d=new Map;for(const h of this.transactions){const m=h.asset;if(I.includes(h.type)){const C=a.get(m);(!C||h.time.getTime()<C.getTime())&&a.set(m,h.time)}else if(b.includes(h.type)){const C=d.get(m);(!C||h.time.getTime()>C.getTime())&&d.set(m,h.time)}}for(const[h,m]of o){const C=document.createElement("tr");n.appendChild(C);const w=document.createElement("td"),x=document.createElement("a");x.innerText=h,x.href="#"+h,w.appendChild(x),C.appendChild(w);const M=a.get(h),N=document.createElement("td");M&&(N.innerText=M.toISOString().split("T")[0]),C.appendChild(N);const O=d.get(h),R=document.createElement("td");O&&(R.innerText=O.toISOString().split("T")[0]),C.appendChild(R);const D=document.createElement("td");D.innerText=m.toFixed(2),D.classList.add(m.amount>0?"positive":"negative"),C.appendChild(D)}const c=Array.from(n.rows).slice(1);c.sort((h,m)=>h.cells[0].innerText.localeCompare(m.cells[0].innerText));for(const h of c)n.appendChild(h);const y=document.createElement("tr");y.classList.add("totalRow"),n.appendChild(y);const T=document.createElement("td");T.innerText="Total",y.appendChild(T),y.appendChild(document.createElement("td")),y.appendChild(document.createElement("td"));const p=document.createElement("td"),g=this.transactions.reduce((h,m)=>h.plus(m.gainOrLoss.convert(m.time,this.model.exchange)),new l(0,this.model.exchange.targetCurrency));return p.innerText=g.toFixed(2),p.classList.add(g.amount>0?"positive":"negative"),y.appendChild(p),e}}class te{constructor(e){this.model=e}render(){const e=document.createElement("div"),t=document.createElement("h2");t.innerText="Realized gain or loss for all years",e.appendChild(t);const n=this.model.executedTransactions,s=n.map(u=>u.time.getUTCFullYear()),i=Array.from(new Set(s)).sort((u,o)=>u-o);for(const u of i){const o=n.filter(a=>a.time.getUTCFullYear()===u);e.appendChild(new ee(this.model,u,o).render())}return e}}async function ne(r,e,t){const n=r.transactions.sort((u,o)=>u.time.getTime()-o.time.getTime()),s=await K(e,n,t),i=re(n);return r.warnings.push(...i),{file:r,executedTransactions:n,exchange:s}}function re(r){const e=r.filter(n=>b.includes(n.type)),t=[];for(const n of e){const s=r.filter(a=>I.includes(a.type)&&a.asset===n.asset&&a.time<n.time&&Math.abs(a.quantitySold-a.quantity)>J);let i=n.quantity,u=new l(0,n.priceCurrency),o=new l(0,n.priceCurrency);for(const a of s){const d=Math.min(a.quantity-a.quantitySold,i);if(a.quantitySold+=d,u=u.plus(a.total.multiply(d/a.quantity)),o=o.plus(a.fee.multiply(d/a.quantity)),i-=d,i===0)break}n.price.amount*i>.05&&t.push(`Unable to find the buy for ${i} ${n.asset} in ${n.raw} - gains can be overstated by ${n.price.multiply(i).toFixed(2)}`),n.gainOrLoss=n.total.minus(u)}return t}function se(r){let e=0;for(const t of r)W.includes(t.type)?e+=t.quantity:$.includes(t.type)&&(e-=t.quantity);return e}class ie{constructor(e,t,n){v(this,"firstTransaction");v(this,"priceCurrency");v(this,"headers");v(this,"needsCurrencyConversion",!1);if(this.groupKey=e,this.transactions=t,this.exchange=n,t.length===0)throw new Error("No transactions provided for "+e);this.firstTransaction=t[0],this.priceCurrency=this.firstTransaction.priceCurrency,this.needsCurrencyConversion=Z(t,this.exchange.targetCurrency),this.headers=["Time","Type",`Quantity ${this.firstTransaction.asset}`,`Price ${f(this.priceCurrency)}`],this.needsCurrencyConversion&&this.headers.push(`Price ${f(this.exchange.targetCurrency)}`),this.headers.push(`Fee ${f(this.priceCurrency)}`),this.needsCurrencyConversion&&this.headers.push(`Fee ${f(this.exchange.targetCurrency)}`),this.headers.push(`Total ${f(this.priceCurrency)}`),this.needsCurrencyConversion&&this.headers.push(`Total ${f(this.exchange.targetCurrency)}`),this.headers.push(`Gain ${f(this.priceCurrency)}`),this.needsCurrencyConversion&&this.headers.push(`Gain ${f(this.exchange.targetCurrency)}`)}renderGroup(){const e=document.createElement("div");if(e.classList.add("transactionGroup"),this.transactions.length===0)return e;this.transactions.sort((n,s)=>n.time.getTime()-s.time.getTime()),e.dataset.sortKey=`${E.includes(this.firstTransaction.asset)||L.includes(this.firstTransaction.asset)?0:1}-${this.firstTransaction.asset}`,this.renderGroupHeader(e);const t=this.createTableStructure(e);return this.renderTableHeader(t),this.renderTableBody(t),this.renderTableFooter(t),this.renderGainLossByYear(e),e}renderGroupHeader(e){const t=document.createElement("h2");t.innerText=this.groupKey,t.id=this.firstTransaction.asset,e.appendChild(t);const n=document.createElement("button");n.innerText="Print",n.className="print-button",n.style.marginLeft="1em",n.onclick=()=>{const s=window.open("","_blank");s&&(s.document.write("<html><head><title>"+this.groupKey+"</title>"),Array.from(document.querySelectorAll('link[rel="stylesheet"],style')).forEach(i=>{s.document.write(i.outerHTML)}),s.document.write("</head><body>"),s.document.write(e.outerHTML),s.document.write("</body></html>"),s.document.close(),s.focus(),setTimeout(()=>{s.print()},300))},t.appendChild(n)}createTableStructure(e){const t=document.createElement("table"),n=document.createElement("div");return n.classList.add("tableScroller"),n.appendChild(t),e.appendChild(n),t}renderTableHeader(e){const t=document.createElement("thead"),n=document.createElement("tr");t.appendChild(n),e.appendChild(t);for(const s of this.headers){const i=document.createElement("th");i.innerText=s,F(s)&&i.classList.add("numeric"),n.appendChild(i)}}renderTableBody(e){const t=E.includes(this.firstTransaction.asset)||L.includes(this.firstTransaction.asset)?1:-1;for(const n of this.transactions){const s=document.createElement("tr");s.title=n.raw,e.appendChild(s);const i=[n.time.toISOString().split("T")[0],n.type,n.quantity,n.price];this.needsCurrencyConversion&&i.push(n.price.convert(n.time,this.exchange)),i.push(n.fee),this.needsCurrencyConversion&&i.push(n.fee.convert(n.time,this.exchange));const u=n.total.multiply(t*($.includes(n.type)?-1:1));i.push(u),this.needsCurrencyConversion&&i.push(u.convert(n.time,this.exchange)),i.push(n.gainOrLoss),this.needsCurrencyConversion&&i.push(n.gainOrLoss.convert(n.time,this.exchange));for(let o=0;o<i.length;o++){const a=i[o],d=document.createElement("td"),c=this.headers[o];a===0?d.innerText="":typeof a=="number"?(d.innerText=a.toFixed(c.startsWith("Price")&&Math.abs(a)<1e4?4:2),d.classList.add("numeric"),(c.startsWith("Total")||c.startsWith("Gain"))&&d.classList.add(a>0?"positive":"negative")):a instanceof l?(d.innerText=a.toFixed(c.startsWith("Price")&&Math.abs(a.amount)<1e4?4:2),d.classList.add("numeric"),(c.startsWith("Total")||c.startsWith("Gain"))&&d.classList.add(a.amount>0?"positive":"negative")):d.innerText=String(a),s.appendChild(d)}}}renderTableFooter(e){const t=document.createElement("tr");t.classList.add("totalRow"),e.appendChild(t),t.appendChild(this.createTd("Total")),t.appendChild(document.createElement("td"));const n=se(this.transactions);t.appendChild(this.createNumericTd(n,2,!1)),t.appendChild(document.createElement("td")),this.needsCurrencyConversion&&t.appendChild(document.createElement("td"));const s=this.transactions.reduce((a,d)=>a.plus(d.fee),new l(0,this.priceCurrency));if(t.appendChild(this.createMoneyTd(s)),this.needsCurrencyConversion){const a=this.transactions.reduce((d,c)=>d.plus(c.fee.convert(c.time,this.exchange)),new l(0,this.exchange.targetCurrency));t.appendChild(this.createMoneyTd(a))}const i=E.includes(this.firstTransaction.asset)||L.includes(this.firstTransaction.asset)?1:-1,u=this.transactions.reduce((a,d)=>a.plus(d.total.multiply(($.includes(d.type)?-1:1)*i)),new l(0,this.priceCurrency));if(t.appendChild(this.createMoneyTd(u)),this.needsCurrencyConversion){const a=this.transactions.reduce((d,c)=>d.plus(c.total.convert(c.time,this.exchange).multiply(($.includes(c.type)?-1:1)*i)),new l(0,this.exchange.targetCurrency));t.appendChild(this.createMoneyTd(a))}const o=this.transactions.reduce((a,d)=>a.plus(d.gainOrLoss.convert(d.time,this.exchange,this.priceCurrency)),new l(0,this.priceCurrency));if(t.appendChild(this.createMoneyTd(o)),this.needsCurrencyConversion){const a=this.transactions.reduce((d,c)=>d.plus(c.gainOrLoss.convert(c.time,this.exchange)),new l(0,this.exchange.targetCurrency));t.appendChild(this.createMoneyTd(a))}}renderGainLossByYear(e){const t=new Map,n=new Map,s=new Map,i=new Map;for(const c of this.transactions){if(c.gainOrLoss.amount!==0){const p=c.time.getUTCFullYear(),g=t.get(p)||new l(0,this.priceCurrency);if(t.set(p,g.plus(c.gainOrLoss)),this.needsCurrencyConversion){const h=n.get(p)||new l(0,this.exchange.targetCurrency);n.set(p,h.plus(c.gainOrLoss.convert(c.time,this.exchange)))}}const y=c.time.getUTCFullYear(),T=s.get(y)||new l(0,this.priceCurrency);if(s.set(y,T.plus(c.fee)),this.needsCurrencyConversion){const p=i.get(y)||new l(0,this.exchange.targetCurrency);i.set(y,p.plus(c.fee.convert(c.time,this.exchange)))}}const u=t.size===0;e.appendChild(document.createElement("br"));const o=document.createElement("table");e.appendChild(o);const a=document.createElement("thead"),d=document.createElement("tr");if(a.appendChild(d),o.appendChild(a),u){const c=["Year"];c.push(`Fee ${f(this.priceCurrency)}`),this.needsCurrencyConversion&&c.push(`Fee ${f(this.exchange.targetCurrency)}`),c.push(`Total w/o Fees ${f(this.priceCurrency)}`),this.needsCurrencyConversion&&c.push(`Total w/o Fees ${f(this.exchange.targetCurrency)}`),c.push(`Total ${f(this.priceCurrency)}`),this.needsCurrencyConversion&&c.push(`Total ${f(this.exchange.targetCurrency)}`);for(const p of c){const g=document.createElement("th");g.innerText=p,F(p)&&g.classList.add("numeric"),d.appendChild(g)}const y=new Map,T=new Map;for(const p of this.transactions){const g=p.time.getUTCFullYear(),h=y.get(g)||new l(0,this.priceCurrency);if(y.set(g,h.plus(p.total)),this.needsCurrencyConversion){const m=T.get(g)||new l(0,this.exchange.targetCurrency);T.set(g,m.plus(p.total.convert(p.time,this.exchange)))}}for(const[p,g]of y){const h=document.createElement("tr");o.appendChild(h),h.appendChild(this.createTd(String(p)));const m=s.get(p)||new l(0,this.priceCurrency);if(h.appendChild(this.createMoneyTd(m)),this.needsCurrencyConversion){const w=i.get(p)||new l(0,this.exchange.targetCurrency);h.appendChild(this.createMoneyTd(w))}const C=g.minus(m);if(h.appendChild(this.createMoneyTd(C)),this.needsCurrencyConversion){const w=T.get(p)||new l(0,this.exchange.targetCurrency),x=i.get(p)||new l(0,this.exchange.targetCurrency);h.appendChild(this.createMoneyTd(w.minus(x)))}if(h.appendChild(this.createMoneyTd(g)),this.needsCurrencyConversion){const w=T.get(p)||new l(0,this.exchange.targetCurrency);h.appendChild(this.createMoneyTd(w))}}}else{const c=["Year"];c.push(`Fee ${f(this.priceCurrency)}`),this.needsCurrencyConversion&&c.push(`Fee ${f(this.exchange.targetCurrency)}`),c.push(`Gain w/o Fees ${f(this.priceCurrency)}`),this.needsCurrencyConversion&&c.push(`Gain w/o Fees ${f(this.exchange.targetCurrency)}`),c.push(`Gain ${f(this.priceCurrency)}`),this.needsCurrencyConversion&&c.push(`Gain ${f(this.exchange.targetCurrency)}`);for(const y of c){const T=document.createElement("th");T.innerText=y,F(y)&&T.classList.add("numeric"),d.appendChild(T)}for(const[y,T]of t){const p=document.createElement("tr");o.appendChild(p),p.appendChild(this.createTd(String(y)));const g=s.get(y)||new l(0,this.priceCurrency);if(p.appendChild(this.createMoneyTd(g)),this.needsCurrencyConversion){const m=i.get(y)||new l(0,this.exchange.targetCurrency);p.appendChild(this.createMoneyTd(m))}const h=T.minus(g);if(p.appendChild(this.createMoneyTd(h)),this.needsCurrencyConversion){const m=n.get(y)||new l(0,this.exchange.targetCurrency),C=i.get(y)||new l(0,this.exchange.targetCurrency);p.appendChild(this.createMoneyTd(m.minus(C)))}if(p.appendChild(this.createMoneyTd(T)),this.needsCurrencyConversion){const m=n.get(y)||new l(0,this.exchange.targetCurrency);p.appendChild(this.createMoneyTd(m))}}}}createTd(e){const t=document.createElement("td");return t.innerText=e,t}createNumericTd(e,t,n){const s=document.createElement("td");return e&&(s.innerText=e.toFixed(t),s.classList.add("numeric"),n&&s.classList.add(e>0?"positive":"negative")),s}createMoneyTd(e){const t=document.createElement("td");t.innerText=e.toString(),t.classList.add("numeric"),t.classList.add(e.amount>0?"positive":"negative");debugger;return t}}class ae{constructor(e){this.model=e}render(){const e=document.createElement("div"),t=oe(this.model.executedTransactions),n=[];for(const[s,i]of t)n.push(new ie(s,i,this.model.exchange).renderGroup());return n.sort((s,i)=>s.dataset.sortKey.localeCompare(i.dataset.sortKey)),e.replaceChildren(...n),e}}function oe(r){const e=new Map;for(const t of r){const n=ce(t),s=e.get(n)||[];s.push(t),e.set(n,s)}return e}function ce(r){return r.type==="Deposit"||r.type==="Withdrawal"?"Deposit / Withdrawal":r.type==="Reward Income"?r.type:r.type.startsWith("Subscription Rebate")?"Subscription Rebate":L.includes(r.asset)&&(I.includes(r.type)||b.includes(r.type))?`${r.asset} Trading`:E.includes(r.asset)?r.type:r.asset}const U=document.getElementById("transactionOutput"),ue=document.getElementById("calculateGainLoss"),G=document.getElementById("currencySelect");for(const r of E.concat().sort()){if(r==="USD")continue;const e=document.createElement("option");e.value=r,e.innerText=r,e.selected=r==="EUR",G.appendChild(e)}const P=document.getElementById("transactionInput");P.addEventListener("change",q);function q(){const r=P.files;if(!r)return;const e=r[0];if(!e)return;const t=new FileReader;t.onload=async()=>{try{await de(z(t.result))}catch(n){alert(`Error parsing file: ${n}`)}},t.onerror=n=>{alert(`Error reading file: ${n}`)},t.readAsText(e)}q();async function de(r){const e=await ne(r,le(),t=>{U.innerText=t});U.replaceChildren(new _().render(e),new te(e).render(),new ae(e).render())}function le(){return ue.checked&&G.value||"USD"}

</script>
  <style>
html{padding:0;margin:0}body{font-family:Roboto;padding:0 20px;max-width:1000px;margin:0 auto 50px}.error{color:red;padding-bottom:10px}.warning{color:#ff9100;padding-bottom:10px}table{border-collapse:collapse}.yearSecurityTable{width:100%}.transactionGroup{margin:20px 0}th,td{padding:5px;border:1px solid #ddd;text-align:left;min-width:50px}th,.totalRow{background-color:#f2f2f2;font-weight:700}.numeric{text-align:right}.positive{color:green;text-align:right}.negative{color:red;text-align:right}@media print{.print-button{display:none}}

</style>
</head>

<body>
  <h1>📖 coinbuch</h1>
  <p>
    Open-source tool for analysing Coinbase transaction log.
    <a href="https://github.com/kachurovskiy/coinbuch/">Learn more on GitHub</a>
  </p>
  <p>
    <label>
      <input type="checkbox" id="calculateGainLoss" />
      Calculate Gain in another currency
    </label>
    <label for="currencySelect">Currency:</label>
    <select id="currencySelect"></select>
  </p>
  <p>
    Transactions CSV from <a href="https://accounts.coinbase.com/statements">accounts.coinbase.com/statements</a>: <input type="file" id="transactionInput" accept=".csv"/>
  </p>
  <div id="transactionOutput"></div>
  
</body>

</html>
